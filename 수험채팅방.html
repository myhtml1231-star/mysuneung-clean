<!DOCTYPE html>
<html lang="ko">
<head>
<script type="text/javascript">
atOptions = {
  'key' : 'a7003aca2325ea148d3e149ec472c320',
  'format' : 'iframe',
  'height' : 60,
  'width' : 468,
  'params' : {}
};
</script>
<script type="text/javascript" src="https://www.highperformanceformat.com/a7003aca2325ea148d3e149ec472c320/invoke.js"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìˆ˜í—˜ì±—</title>
  <style>
    header img {
  width: 40px;   /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆ ê°€ëŠ¥ */
  height: 40px;
  object-fit: contain;  /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€ */
  margin-bottom: 5px;
}

.chat-warning {
  font-size: 14px;   /* ğŸ”¥ ê¸€ì í¬ê¸° í‚¤ì›€ */
  color: #999;
  margin-top: -4px;
  margin-bottom: 8px;
  width: 100%;
  text-align: right;
  font-weight: 600;  /* ğŸ”¥ ì‚´ì§ ë‘ê»ê²Œ í•˜ë©´ ë” ì˜ ë³´ì„ */
}
.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.75);
  color: white;
  padding: 12px 18px;
  border-radius: 6px;
  font-size: 14px;
  z-index: 2000;
  animation: fadeInOut 1.8s ease-in-out;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -40%); }
  15% { opacity: 1; transform: translate(-50%, -50%); }
  85% { opacity: 1; transform: translate(-50%, -50%); }
  100% { opacity: 0; transform: translate(-50%, -60%); }
}

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", "Noto Sans KR", sans-serif;
      background: #f5f5f5;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Header */
    header {
      background: white;
      border-bottom: 1px solid #ddd;
      padding: 15px 20px;
      text-align: center;
      flex-shrink: 0;
    }

    .logo {
      width: 45px;
      height: 45px;
      background: #F4B733;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 22px;
      color: white;
      margin-bottom: 8px;
    }

    header h1 {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    /* Chat Container */
    .chat-container {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }

    /* Messages Area */
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: white;
    }

    .message {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
      animation: slideUp 0.3s ease-out;
      align-items: flex-start; /* ê¸°ë³¸ì€ ì™¼ìª½ ì •ë ¬ */
    }

    /* â˜… ë‚´ ë©”ì‹œì§€ ì˜¤ë¥¸ìª½ ì •ë ¬ */
    .message.me {
      align-items: flex-end;
    }

    .message-header {
      font-size: 12px;
      color: #999;
      margin-bottom: 4px;
      width: 100%;
    }

    /* â˜… ë‚´ ë©”ì‹œì§€ í—¤ë”ëŠ” ì˜¤ë¥¸ìª½ ì •ë ¬ */
    .message.me .message-header {
      text-align: right;
    }

    .message-author {
      font-weight: bold;
      color: #666;
    }

    .message-time {
      margin-left: 8px;
    }

    /* â˜… ë‚˜ ë°°ì§€ */
    .badge-me {
      display: inline-block;
      margin-left: 4px;
      padding: 1px 4px;
      font-size: 10px;
      border-radius: 4px;
      background: #F4B733;
      color: white;
    }

    .message-bubble {
      padding: 10px 14px;
      border-radius: 8px;
      max-width: 70%;
      word-break: break-word;
      font-size: 14px;
      line-height: 1.4;
    }

    /* â˜… ìƒëŒ€ë°© ë§í’ì„  (ì™¼ìª½, íšŒìƒ‰) */
    .message.other .message-bubble {
      background: #f3f4f6;
      color: #333;
      align-self: flex-start;
    }

    /* â˜… ë‚´ ë§í’ì„  (ì˜¤ë¥¸ìª½, ë…¸ë€ìƒ‰) */
    .message.me .message-bubble {
      background: #F4B733;
      color: white;
      align-self: flex-end;
    }

    .empty-state {
      text-align: center;
      color: #ccc;
      font-size: 14px;
      margin: auto;
    }

    /* Input Area */
    .input-area {
      background: white;
      border-top: 1px solid #ddd;
      padding: 15px;
      flex-shrink: 0;
      border-radius: 8px 8px 0 0;
    }

    .login-form {
      display: none;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    .login-form.active {
      display: block;
    }

    .form-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 12px;
      color: #333;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      margin-bottom: 4px;
    }

    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
    }

    .form-group input:focus {
      outline: none;
      border-color: #F4B733;
      background: #fffef5;
    }

    .btn-login {
      width: 100%;
      background: #F4B733;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-login:hover {
      background: #e5a726;
    }

    .chat-form {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      flex-direction: column; /* â˜… ìœ„ì— ìœ ì €ì •ë³´, ì•„ë˜ì— ì…ë ¥ì°½/ë²„íŠ¼ */
    }

    .chat-form.hidden {
      display: none;
    }

    .chat-form input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
      width: 100%;
    }

    .chat-form input:focus {
      outline: none;
      border-color: #F4B733;
      background: #fffef5;
    }

    .btn-send {
      background: #F4B733;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      align-self: flex-end;
    }

    .btn-send:hover {
      background: #e5a726;
    }

    .user-info {
      font-size: 12px;
      color: #999;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info strong {
      color: #F4B733;
    }

    .btn-logout {
      background: #eee;
      color: #333;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      margin-left: 10px;
      flex-shrink: 0;
    }

    .btn-logout:hover {
      background: #ddd;
    }

.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  z-index: 2000;
  width: auto;          /* ë°•ìŠ¤ í¬ê¸° ìë™ ì¡°ì ˆ */
  max-width: 300px;     /* ë„ˆë¬´ ì•ˆ ì»¤ì§€ë„ë¡ ìƒí•œ ì„¤ì • */
  text-align: center;   /* ë‚´ìš© ê°€ìš´ë° ì •ë ¬ */
  display: inline-block; /* í¬ê¸°ë¥¼ ë‚´ìš©ì— ë§ê²Œ ì¤„ì„ */
}

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 640px) {
      .messages {
        padding: 15px;
      }

      .message-bubble {
        max-width: 85%;
      }

      .input-area {
        padding: 12px;
      }

      .chat-form {
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <header>
     <img src="Images/logo.png" alt="logo">
    <h1>ìˆ˜í—˜ ì±—</h1>
  </header>

  <div class="chat-container">
    <div class="messages" id="messages"></div>

    <div class="input-area">
      <!-- Login Form -->
      <div class="login-form" id="loginForm">
        <div class="form-title">ì±„íŒ…ë°© ì…ì¥</div>
        <div class="form-group">
          <label>ë‹‰ë„¤ì„</label>
          <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
        </div>
        <div class="form-group">
          <label>ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
        </div>
        <button class="btn-login" onclick="handleLogin()">ì…ì¥</button>
      </div>

      <!-- Chat Form -->
      <div id="chatForm" class="chat-form hidden">
        <div class="user-info">
          <span><strong id="currentUser"></strong> ë¡œê·¸ì¸ë¨</span>
          <button class="btn-logout" onclick="handleLogout()">ë‚˜ê°€ê¸°</button>
        </div>
        <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥..." />
<div class="chat-warning">âš ï¸ ìš•ì„¤, ë¹„ì†ì–´ ì‚¬ìš© ì‹œ ì „ì†¡ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

        <button class="btn-send" onclick="sendMessage()">ì „ì†¡</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      addDoc,
      collection,
      getFirestore,
      onSnapshot,
      orderBy,
      query,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCeEo-XbOdIJSqYRTbA4re3Ot1xWeEjfW0",
      authDomain: "mysuneung.firebaseapp.com",
      projectId: "mysuneung",
      storageBucket: "mysuneung.firebasestorage.app",
      messagingSenderId: "1047770825934",
      appId: "1:1047770825934:web:cf4afe0e4331422e043c9f",
      measurementId: "G-B7Q0KVYYH5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const messagesRef = collection(db, "chatMessages");

    const bannedWords = ["ì”¨ë°œ", "ë°”ë³´", "ë³‘ì‹ "];

    let messages = [];
    let currentUser = null;
    let userPasswords = JSON.parse(localStorage.getItem('user_passwords') || '{}');
    let unsubscribe = null;

    function containsBannedWords(text) {
      return bannedWords.some(word => text.includes(word));
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 2000);
    }

    function renderMessages() {
      const messagesDiv = document.getElementById('messages');

      if (messages.length === 0) {
        messagesDiv.innerHTML = '<div class="empty-state">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      messagesDiv.innerHTML = messages.map(msg => {
        const isMe = currentUser && msg.author === currentUser;
        const messageClass = isMe ? 'message me' : 'message other';
        const meBadge = isMe ? '<span class="badge-me">ë‚˜</span>' : '';

        const createdAt = msg.createdAt?.toDate ? msg.createdAt.toDate() : new Date();
        const time = `${String(createdAt.getHours()).padStart(2, '0')}:${String(createdAt.getMinutes()).padStart(2, '0')}`;

        return `
          <div class="${messageClass}">
            <div class="message-header">
              <span class="message-author">${msg.author}</span>
              ${meBadge}
              <span class="message-time">${time}</span>
            </div>
            <div class="message-bubble">${msg.content}</div>
          </div>
        `;
      }).join('');

      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function subscribeMessages() {
      if (unsubscribe) unsubscribe();

      unsubscribe = onSnapshot(query(messagesRef, orderBy('createdAt', 'asc')), (snap) => {
        messages = snap.docs.map((docu) => ({ id: docu.id, ...docu.data() }));
        renderMessages();
      }, (err) => {
        console.error('ì±„íŒ… ë©”ì‹œì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', err);
        showToast('ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      });
    }

    window.handleLogin = function () {
      const nickname = document.getElementById('nickname').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!nickname) {
        showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      if (!password) {
        showToast('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      if (userPasswords[nickname] && userPasswords[nickname] !== password) {
        showToast('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤');
        return;
      }

      if (!userPasswords[nickname]) {
        userPasswords[nickname] = password;
        localStorage.setItem('user_passwords', JSON.stringify(userPasswords));
      }

      currentUser = nickname;
      document.getElementById('currentUser').textContent = `${nickname}ë‹˜`;
      document.getElementById('loginForm').classList.remove('active');
      document.getElementById('chatForm').classList.remove('hidden');
      document.getElementById('messageInput').focus();
      document.getElementById('nickname').value = '';
      document.getElementById('password').value = '';

      renderMessages();
    };

    window.handleLogout = function () {
      currentUser = null;
      document.getElementById('loginForm').classList.add('active');
      document.getElementById('chatForm').classList.add('hidden');
      document.getElementById('nickname').value = '';
      document.getElementById('password').value = '';
      document.getElementById('messageInput').value = '';

      renderMessages();
    };

    window.sendMessage = async function () {
      const content = document.getElementById('messageInput').value.trim();

      if (containsBannedWords(content)) {
        showToast("ë¶€ì ì ˆí•œ í‘œí˜„ì´ í¬í•¨ë˜ì–´ ì „ì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      if (!content) {
        showToast('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      if (!currentUser) {
        showToast('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”');
        return;
      }

      try {
        await addDoc(messagesRef, {
          author: currentUser,
          content,
          createdAt: serverTimestamp()
        });

        document.getElementById('messageInput').value = '';
      } catch (err) {
        console.error('ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨', err);
        showToast('ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      }
    };

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && currentUser && document.getElementById('messageInput') === document.activeElement) {
        window.sendMessage();
      }
    });

    document.getElementById('loginForm').classList.add('active');
    subscribeMessages();
  </script>
</body>
</html>
